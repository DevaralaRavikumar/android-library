description = "Urban Airship Android Core SDK"

apply from: "../common-build.gradle"

configurations {
    doclava
}


android.testOptions.unitTests.includeAndroidResources = true

dependencies {
    // Required
    api "com.android.support:support-v4:$rootProject.supportLibVersion"
    api "com.android.support:support-annotations:$rootProject.supportLibVersion"

    // Optional
    compileOnly "com.google.android.gms:play-services-location:$rootProject.playServicesLocationVersion"
    compileOnly "com.android.support:appcompat-v7:$rootProject.supportLibVersion"
    compileOnly "com.google.android.gms:play-services-base:$rootProject.playServicesBaseVersion"

    // Tests
    testImplementation "junit:junit:$rootProject.junitVersion"
    testImplementation "org.mockito:mockito-core:$rootProject.mockitoVersion"
    testImplementation "org.robolectric:robolectric:$rootProject.robolectricVersion"
    testImplementation "org.robolectric:shadows-supportv4:$rootProject.robolectricVersion"
    testImplementation "com.google.android.gms:play-services-location:$rootProject.playServicesLocationVersion"

    // Docs
    doclava("com.google.doclava:doclava:$rootProject.doclavaVersion")
}

android.libraryVariants.all { variant ->
    // Add a javadoc task for each variant
    task("javadoc${variant.name.capitalize()}", type: Javadoc, dependsOn: "assemble${variant.name.capitalize()}") {
        title = null
        source = android.sourceSets.main.java.sourceFiles

        exclude '**/BuildConfig.java'
        exclude '**/R.java'

        doFirst {
            classpath += project.files(android.getBootClasspath().join(File.pathSeparator))
            classpath += variant.javaCompiler.classpath

            options {
                docletpath = configurations.doclava.files as List
                doclet "com.google.doclava.Doclava"
                bootClasspath new File(System.getenv('JAVA_HOME') + "/jre/lib/rt.jar")
                addStringOption "hdf project.name", "Urban Airship Android Library"
                addStringOption "hdf project.version", project.version
                addStringOption "apiversion", "v2"
                addStringOption "federate android", "http://developer.android.com/reference"
                addStringOption "federationxml android", "docs/android-22.xml"
                addStringOption "templatedir", "docs/template"
            }
        }
    }
}

task javadoc(dependsOn: 'javadocRelease')
